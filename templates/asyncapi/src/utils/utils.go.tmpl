// {{ .ModuleName }}/async/utils â€” NATS Subscribe-Helper
package utils

import (
    "github.com/nats-io/nats.go"
    "github.com/rs/zerolog/log"
)

// Subscribe ohne Queue
func Subscribe(nc *nats.Conn, subject string, handler func(*nats.Msg)) {
    _, err := nc.Subscribe(subject, func(msg *nats.Msg) {
        handler(msg)
        log.Debug().Msgf("msg on %s", subject)
    })
    if err != nil {
        log.Error().Err(err).Msgf("Subscribe to %s failed", subject)
    }
}

// QueueSubscribe mit Queue-Group
func QueueSubscribe(nc *nats.Conn, subject, queue string, handler func(*nats.Msg)) {
    _, err := nc.QueueSubscribe(subject, queue, func(msg *nats.Msg) {
        handler(msg)
        log.Debug().Msgf("queued msg on %s [%s]", subject, queue)
    })
    if err != nil {
        log.Error().Err(err).Msgf("QueueSubscribe %s[%s] failed", subject, queue)
    }
}
