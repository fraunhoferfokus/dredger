asyncapi: 3.0.0
info:
  title: Live Wetter Feed
  version: 1.0.0
  description: >-
    A NATS-based microservice that publishes real-time weather readings from
    simulated sensor stations. Multiple subscribers consume this data for
    dashboards, alerts, or logs.
servers:
  localNATS:
    host: localhost:4222
    protocol: nats
    description: Local development NATS server
channels:
  weather-humidity:
    address: weather-humidity
    messages:
      weatherHumidity:
        $ref: '#/components/messages/WeatherHumidity'
      weatherHumidityAlert:
        $ref: '#/components/messages/WeatherHumidityAlert'
  weather-temperature:
    address: weather-temperature
    messages:
      weatherTemperature:
        $ref: '#/components/messages/WeatherTemperature'
      weatherTemperatureAlert:
        $ref: '#/components/messages/WeatherTemperatureAlert'
operations:
  subscribeToHumidityReadings:
    action: receive
    summary: Receives real-time humidity readings and alerts
    channel:
      $ref: '#/channels/weather-humidity'
    messages:
      - $ref: '#/channels/weather-humidity/messages/weatherHumidity'
      - $ref: '#/channels/weather-humidity/messages/weatherHumidityAlert'
  publishHumidityReading:
    action: send
    summary: Publishes simulated humidity readings and alerts
    channel:
      $ref: '#/channels/weather-humidity'
    messages:
      - $ref: '#/channels/weather-humidity/messages/weatherHumidity'
      - $ref: '#/channels/weather-humidity/messages/weatherHumidityAlert'
  subscribeToTemperatureReadings:
    action: receive
    summary: Receives real-time temperature readings and alerts
    channel:
      $ref: '#/channels/weather-temperature'
    messages:
      - $ref: '#/channels/weather-temperature/messages/weatherTemperature'
      - $ref: '#/channels/weather-temperature/messages/weatherTemperatureAlert'
  publishTemperatureReading:
    action: send
    summary: Publishes simulated temperature readings and alerts
    channel:
      $ref: '#/channels/weather-temperature'
    messages:
      - $ref: '#/channels/weather-temperature/messages/weatherTemperature'
      - $ref: '#/channels/weather-temperature/messages/weatherTemperatureAlert'
components:
  messages:
    WeatherHumidity:
      name: WeatherHumidity
      title: Luftfeuchtigkeit
      summary: Real-time Humidity sensor data
      contentType: application/json
      payload:
        type: object
        properties:
          station_id:
            type: string
            example: station-001
          timestamp:
            type: string
            format: date-time
            example: '2025-05-29T14:01:00Z'
          humidity_percent:
            type: number
            format: float
            example: 60
    WeatherHumidityAlert:
      name: WeatherHumidityAlert
      title: Luftfeuchtigkeitswarnung
      summary: Alert for abnormal humidity levels
      contentType: application/json
      payload:
        type: object
        properties:
          station_id:
            type: string
            example: station-001
          timestamp:
            type: string
            format: date-time
            example: '2025-05-29T14:01:00Z'
          alert_level:
            type: string
            enum: [low, medium, high]
            example: high
          message:
            type: string
            example: "Humidity too high!"
    WeatherTemperature:
      name: WeatherTemperature
      title: Temperatur
      summary: Real-time Temperature sensor data
      contentType: application/json
      payload:
        type: object
        properties:
          station_id:
            type: string
            example: station-001
          timestamp:
            type: string
            format: date-time
            example: '2025-05-29T14:01:00Z'
          temperature_c:
            type: number
            format: float
            example: 22.5
    WeatherTemperatureAlert:
      name: WeatherTemperatureAlert
      title: Temperaturwarnung
      summary: Alert for extreme temperature
      contentType: application/json
      payload:
        type: object
        properties:
          station_id:
            type: string
            example: station-001
          timestamp:
            type: string
            format: date-time
            example: '2025-05-29T14:01:00Z'
          alert_level:
            type: string
            enum: [low, medium, high]
            example: medium
          message:
            type: string
            example: "Temperature dropping rapidly!"
